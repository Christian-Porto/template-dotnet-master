<div class="sm:absolute sm:inset-0 flex flex-col flex-auto min-w-0 md:overflow-hidden">
    <div
        class="relative flex flex-col md:flex-row flex-0 md:items-center md:justify-between gap-y-4 p-6 border-b bg-card">
        <div class="text-4xl font-extrabold tracking-tight">Usuários</div>

        <form [formGroup]="form" class="grid grid-cols-4 gap-x-4 gap-y-4 shrink-0 items-center">
            <mat-form-field class="md:col-span-1 col-span-5 fuse-mat-dense fuse-mat-rounded min-w-50"
                [subscriptSizing]="'dynamic'">
                <mat-icon class="icon-size-5" matPrefix [svgIcon]="'heroicons_outline:magnifying-glass'"></mat-icon>
                <input matInput formControlName="name" [autocomplete]="'off'" placeholder="Nome">
            </mat-form-field>

            <mat-form-field class="md:col-span-1 col-span-5 fuse-mat-dense fuse-mat-rounded min-w-50"
                [subscriptSizing]="'dynamic'">
                <mat-icon class="icon-size-5" matPrefix [svgIcon]="'heroicons_outline:magnifying-glass'"></mat-icon>
                <input matInput formControlName="enrollment" [autocomplete]="'off'" placeholder="Matrícula">
            </mat-form-field>

            <mat-form-field class="md:col-span-1 col-span-5 fuse-mat-dense fuse-mat-rounded min-w-50"
                [subscriptSizing]="'dynamic'">
                <mat-icon class="icon-size-5" matPrefix [svgIcon]="'heroicons_outline:magnifying-glass'"></mat-icon>

                <mat-select formControlName="profile" [placeholder]="'Perfil'">
                    <mat-option [value]="null">Todos</mat-option>
                    <mat-option [value]="ProfileEnum.Administrator"> {{ProfileEnum.Administrator | ProfileEnum}} </mat-option>
                    <mat-option [value]="ProfileEnum.Monitor"> {{ProfileEnum.Monitor | ProfileEnum}} </mat-option>
                    <mat-option [value]="ProfileEnum.Student"> {{ProfileEnum.Student | ProfileEnum}} </mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field class="md:col-span-1 col-span-5 fuse-mat-dense fuse-mat-rounded min-w-50"
                [subscriptSizing]="'dynamic'">
                <mat-icon class="icon-size-5" matPrefix [svgIcon]="'heroicons_outline:magnifying-glass'"></mat-icon>

                <mat-select formControlName="status" [placeholder]="'Status'">
                    <mat-option [value]="null">Todos</mat-option>
                    <mat-option [value]="UserStatusEnum.Active"> {{UserStatusEnum.Active | UserStatusEnum}} </mat-option>
                    <mat-option [value]="UserStatusEnum.Inactive"> {{UserStatusEnum.Inactive | UserStatusEnum}} </mat-option>
                </mat-select>
            </mat-form-field>
        </form>
    </div>

    @if(loading){
    <div class="w-full h-full flex justify-center items-center m-auto">
        <mat-progress-spinner class="opacity-100 m-auto" [diameter]="200"
            [mode]="'indeterminate'"></mat-progress-spinner>
    </div>

    }
    @else {
    @if(users?.items.length > 0){
    <div class="w-full overflow-auto">
        <table mat-table [dataSource]="users?.items" multiTemplateDataRows>

            <ng-container matColumnDef="name" sticky>
                <th mat-header-cell *matHeaderCellDef> Nome </th>
                <td mat-cell *matCellDef="let element" class="bg-white">
                    <div>
                        {{element.name}}
                    </div>
                </td>
            </ng-container>

            <ng-container matColumnDef="enrollment">
                <th mat-header-cell *matHeaderCellDef>Matrícula</th>
                <td mat-cell *matCellDef="let element">
                    <div class="whitespace-nowrap overflow-hidden">
                        {{element.enrollment}}
                    </div>
                </td>
            </ng-container>

            <ng-container matColumnDef="profile">
                <th mat-header-cell *matHeaderCellDef>Perfil</th>
                <td mat-cell *matCellDef="let element">
                    <div>
                        {{element.profile | ProfileEnum}}
                    </div>
                </td>
            </ng-container>

            <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let element">
                    <div>
                        {{element.status | UserStatusEnum}}
                    </div>
                </td>
            </ng-container>

            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>
                    <div class="w-full h-full flex justify-center">
                        <span class="w-full text-center">Ações</span>
                    </div>
                </th>
                <td mat-cell *matCellDef="let element">
                    <div class="w-full h-full flex justify-center">
                        <button class="min-w-10 min-h-10 px-2" mat-icon-button [matMenuTriggerFor]="userMenu">
                            <mat-icon class="icon-size-5" [svgIcon]="'heroicons_outline:ellipsis-vertical'"></mat-icon>
                        </button>
                        <mat-menu #userMenu="matMenu">
                            <ng-container>
                                @if(element.profile !== ProfileEnum.Monitor) {
                                    <button mat-menu-item (click)="makeMonitor(element.id)">
                                        <span class="flex items-center">
                                            <mat-icon class="icon-size-5 mr-3"
                                                [svgIcon]="'heroicons_outline:user-plus'"></mat-icon>
                                            <span>Tornar Monitor</span>
                                        </span>
                                    </button>
                                }

                                @if(element.status === UserStatusEnum.Active) {
                                    <button mat-menu-item (click)="toggleStatus(element.id, UserStatusEnum.Inactive)">
                                        <span class="flex items-center">
                                            <mat-icon class="icon-size-5 mr-3"
                                                [svgIcon]="'heroicons_outline:x-circle'"></mat-icon>
                                            <span>Desativar</span>
                                        </span>
                                    </button>
                                } @else {
                                    <button mat-menu-item (click)="toggleStatus(element.id, UserStatusEnum.Active)">
                                        <span class="flex items-center">
                                            <mat-icon class="icon-size-5 mr-3"
                                                [svgIcon]="'heroicons_outline:check-circle'"></mat-icon>
                                            <span>Ativar</span>
                                        </span>
                                    </button>
                                }
                            </ng-container>
                        </mat-menu>
                    </div>
                </td>
            </ng-container>

            <ng-container matColumnDef="paginator">
                <td mat-footer-cell *matFooterCellDef [colSpan]="displayedColumns.length" class="h-20">
                    <mat-paginator class="bg-gray-50 dark:bg-transparent flex justify-end"
                        [ngClass]="{'pointer-events-none': loading}" [length]="users?.totalCount"
                        [pageIndex]="pageIndex" [pageSize]="pageSize" [pageSizeOptions]="[10, 25, 50, 100]"
                        [showFirstLastButtons]="true" (page)="pageEvent($event)">
                    </mat-paginator>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="example-element-row"></tr>
            <tr mat-footer-row *matFooterRowDef="['paginator']; sticky: true"></tr>
        </table>
    </div>
    }
    @else {
    <div>
        <div class="text-center py-30">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                aria-hidden="true">
                <path vector-effect="non-scaling-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M17.982 18.725A7.488 7.488 0 0012 15.75a7.488 7.488 0 00-5.982 2.975m11.963 0a9 9 0 10-11.963 0m11.963 0A8.966 8.966 0 0112 21a8.966 8.966 0 01-5.982-2.275M15 9.75a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            <h3 class="mt-2 text-md font-semibold text-gray-900">Sem usuários cadastrados</h3>
            <p class="mt-1 text-md text-gray-500">Não há usuários disponíveis no momento.</p>
            <div class="mt-6">
                <button type="button" mat-flat-button [color]="'primary'" [routerLink]="['/admin/users/create']">
                    <mat-icon class="icon-size-3" [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                    <span class="ml-2 mr-1">Adicionar novo usuário</span>
                </button>
            </div>
        </div>
    </div>
    }
    }
</div>
