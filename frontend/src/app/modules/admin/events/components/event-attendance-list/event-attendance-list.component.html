<div class="sm:absolute sm:inset-0 flex flex-col flex-auto min-w-0 md:overflow-hidden">

    <div class="relative flex flex-row flex-0 md:items-center md:justify-start pt-6 bg-card">
        <button class="md:col-span-1 col-span-4 fuse-mat-dense" mat-flat-button  [routerLink]="['/admin/events']">
            <mat-icon class="icon-size-5" [svgIcon]="'heroicons_outline:arrow-left'"></mat-icon>
            <span class="ml-2 mr-1">Voltar</span>
        </button>
    </div>
    <div
        class="relative flex flex-col md:flex-row flex-0 md:items-center md:justify-start gap-y-4 p-6 border-b bg-card">
        <div class="text-4xl font-extrabold tracking-tight">Lista de Presença: <span class="font-normal">{{event?.name}}</span></div>
    </div>

    <div class="w-full">
        @if(loading){
        <div class="w-full h-96 flex justify-center items-center">
            <mat-progress-spinner class="opacity-100 m-auto" [diameter]="100"
                [mode]="'indeterminate'"></mat-progress-spinner>
        </div>
        }
        @else {
        @if(registrations?.items && registrations.items.length > 0){
        <div class="w-full overflow-auto">
            <table mat-table [dataSource]="registrations.items" class="w-full">

                <!-- Nome Column -->
                <ng-container matColumnDef="name" sticky>
                    <th mat-header-cell *matHeaderCellDef class="bg-gray-50 dark:bg-gray-800 text-center">
                        <span class="font-semibold">Nome Completo</span>
                    </th>
                    <td mat-cell *matCellDef="let element" class="bg-white dark:bg-gray-900">
                        <div class="py-2">
                            {{element.name || '-'}}
                        </div>
                    </td>
                </ng-container>

                <!-- Matrícula Column -->
                <ng-container matColumnDef="enrollment">
                    <th mat-header-cell *matHeaderCellDef class="bg-gray-50 dark:bg-gray-800">
                        <span class="font-semibold">Matrícula</span>
                    </th>
                    <td mat-cell *matCellDef="let element">
                        <div class="whitespace-nowrap">
                            {{element.enrollment || '-'}}
                        </div>
                    </td>
                </ng-container>

                <!-- Presença Column -->
                <ng-container matColumnDef="attended">
                    <th mat-header-cell *matHeaderCellDef class="bg-gray-50 dark:bg-gray-800">
                        <span class="font-semibold">Presença</span>
                    </th>
                    <td mat-cell *matCellDef="let element">
                        <div class="flex items-center gap-2">
                            <mat-checkbox [checked]="element.attended"
                                (change)="toggleAttendance(element, $event.checked)" color="primary">
                            </mat-checkbox>
                            
                        </div>
                    </td>
                </ng-container>

                <!-- Justificativa Column -->
                <ng-container matColumnDef="justification">
                    <th mat-header-cell *matHeaderCellDef class="bg-gray-50 dark:bg-gray-800">
                        <span class="font-semibold">Justificativa</span>
                    </th>
                    <td mat-cell *matCellDef="let element" class="py-2">
                        <mat-form-field class="w-full" subscriptSizing="dynamic">
                            <mat-icon matPrefix class="icon-size-5 text-gray-400"
                                [svgIcon]="'heroicons_outline:document-text'"></mat-icon>
                            <input matInput [value]="element.justification || ''"
                                (input)="onJustificationChange(element.id!, $any($event.target).value)"
                                placeholder="Adicionar justificativa" [disabled]="element.attended" class="text-sm">
                            @if(!element.attended) {
                            <mat-icon matSuffix class="icon-size-4 text-gray-400"
                                matTooltip="A justificativa será salva automaticamente">info</mat-icon>
                            }
                        </mat-form-field>
                    </td>
                </ng-container>

                <!-- Paginator -->
                <ng-container matColumnDef="paginator">
                    <td mat-footer-cell *matFooterCellDef [colSpan]="displayedColumns.length" class="h-20">
                        <mat-paginator class="bg-gray-50 dark:bg-transparent flex justify-end"
                            [ngClass]="{'pointer-events-none': loading}" [length]="registrations?.totalCount || 0"
                            [pageIndex]="pageIndex" [pageSize]="pageSize" [pageSizeOptions]="[10, 25, 50, 100]"
                            [showFirstLastButtons]="true" (page)="onPageChange($event)">
                        </mat-paginator>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"
                    class="hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors"></tr>
                <tr mat-footer-row *matFooterRowDef="['paginator']; sticky: true"></tr>
            </table>
        </div>
        }
        @else {
        <div class="text-center py-20">
            <mat-icon class="icon-size-16 text-gray-400 mb-4" [svgIcon]="'heroicons_outline:users'"></mat-icon>
            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Nenhuma inscrição encontrada</h3>
            <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Não há participantes inscritos neste evento.
            </p>
        </div>
        }
        }
    </div>
</div>
